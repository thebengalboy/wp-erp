window.wperp=window.wperp||{},function(i){"use strict";wperp.template=function(t){var n={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(e){return _.template(i("#tmpl-"+t).html(),null,n)(e)}},wperp.scriptReload=function(e,t){wp.ajax.send({data:{action:e},success:function(e){i("#"+t).html(e.content)},error:function(e){alert(e)}})},wperp.timeFormat=function(e){if(null!=e){var t=e.toString(),n=(e=new Date(t.substr(0,4),t.substr(5,2)-1,t.substr(8,2),t.substr(11,2),t.substr(14,2),t.substr(17,2))).getHours(),o=e.getMinutes(),a=12<=n?"pm":"am";return(n=(n%=12)||12)+":"+(o=o<10?"0"+o:o)+" "+a}},wperp.dateFormat=function(e,t){if(null!=e){var n=e.toString(),o=("0"+((e=new Date(n.substr(0,4),n.substr(5,2)-1,n.substr(8,2),n.substr(11,2),n.substr(14,2),n.substr(17,2))).getMonth()+1)).slice(-2),a=("0"+e.getDate()).slice(-2),r={Y:e.getFullYear(),m:o,F:["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()],M:["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"][e.getMonth()],d:a,j:a};return t.replace(/Y|m|d|j|M|F/gi,function(e){return r[e]})}},wperp.parseCondition=function(e){var t={},n=e.split(/([a-zA-Z0-9\s\-\_\+\.\,\:]+)/);return""==n[0]?t.condition="":t.condition=n[0],t.val=n[1],t},wperp.erp_parse_str=function(e,t){var n,o,a,r,i,p,s,c,l,d,u,f,h,m=String(e).replace(/^&/,"").replace(/^\?/,"").replace(/&$/,"").split("&"),g=m.length,w=function(e){return decodeURIComponent(e.replace(/\+/g,"%20"))};for(t||(t=this.window),n=0;n<g;n++){for(l=w((c=m[n].split("="))[0]),d=c.length<2?"":w(c[1]);" "===l.charAt(0);)l=l.slice(1);if(-1<l.indexOf("\0")&&(l=l.slice(0,l.indexOf("\0"))),l&&"["!==l.charAt(0)){for(f=[],o=u=0;o<l.length;o++)if("["!==l.charAt(o)||u){if("]"===l.charAt(o)&&u&&(f.length||f.push(l.slice(0,u-1)),f.push(l.substr(u,o-u)),u=0,"["!==l.charAt(o+1)))break}else u=o+1;for(f.length||(f=[l]),o=0;o<f[0].length&&(" "!==(s=f[0].charAt(o))&&"."!==s&&"["!==s||(f[0]=f[0].substr(0,o)+"_"+f[0].substr(o+1)),"["!==s);o++);for(p=t,o=0,h=f.length;o<h;o++)if(l=f[o].replace(/^['"]/,"").replace(/['"]$/,""),o!==f.length-1,i=p,""!==l&&" "!==l||0===o)void 0===p[l]&&(p[l]={}),p=p[l];else{for(r in a=-1,p)p.hasOwnProperty(r)&&a<+r&&r.match(/^\d+$/g)&&(a=+r);l=a+1}i[l]=d}}},wperp.erpGetParamByName=function(e,t){t=t.toLowerCase(),e=e.replace(/[\[\]]/g,"\\$&").toLowerCase();var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},wperp.erpRemoveURLParameter=function(e,t){var n=e.split("?");if(2<=n.length){for(var o=encodeURIComponent(t)+"=",a=n[1].split(/[&;]/g),r=a.length;0<r--;)-1!==a[r].lastIndexOf(o,0)&&a.splice(r,1);return e=n[0]+(0<a.length?"?"+a.join("&"):"")}return e},wperp.swalSpinnerVisible=function(){swal({title:"",html:!0,showCancelButton:!1,showConfirmButton:!1}),i(".la-ball-fall").css({opacity:1,visibility:"visible",top:"-17px",color:"#008ec2"})},wperp.swalSpinnerHidden=function(){i(".la-ball-fall").css({opacity:0,visibility:"hidden"})};var n={initialize:function(){i("#postimagediv").on("click","#set-company-thumbnail",this.setCompanyLogo),i("#postimagediv").on("click","a.remove-logo",this.removeCompanyLogo),i("body").on("click","a#erp-company-new-location",this.newCompanyLocation),i(".erp-company-single").on("click","a.edit-location",this.editCompanyLocation),i(".erp-company-single").on("click","a.remove-location",this.removeCompanyLocation),i(".erp-hr-employees").on("click","a#erp-employee-new",this.modalOpen),i("body").on("click","a#erp-company-new-location",this.modalOpen),i("body").on("click","#erp-customer-new",this.modalOpen),i("body").on("change","select.erp-country-select",this.populateState),i("body").on("erp-hr-after-new-location",this.afterNewLocation),i(".erp-hr-audit-log").on("click","a.erp-audit-log-view-changes",this.viewLogChanges),i("body").on("change","#filter_duration",this.customFilter),i("body").on("click",".notice-pdf .notice-dismiss",this.pdfNotice.dismiss),i("body").on("click",".email-subscribe-btn",this.emailSubscribe),this.initFields()},afterNewLocation:function(e,t){wperp.scriptReload("erp_hr_script_reload","tmpl-erp-new-employee"),i(".erp-hr-location-drop-down").append('<option selected="selected" value="'+t.id+'">'+t.title+"</option>"),i(".erp-hr-location-drop-down").select2("val",t.id)},initFields:function(){i(".erp-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"-50:+5"}),i(".erp-date-picker-from").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0,numberOfMonths:1,onClose:function(e){i(".erp-date-picker-to").datepicker("option","minDate",e)}}),i(".erp-date-picker-to").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,numberOfMonths:1,onClose:function(e){i(".erp-date-picker-from").datepicker("option","maxDate",e)}}),i(".erp-select2").select2({placeholder:i(this).attr("data-placeholder")});var e=i(".erp-settings").find("#mainform"),t=i(".erp-tools-form");e.length&&e.areYouSure({message:wpErp.formUnsavedMsg}),t.length&&t.areYouSure({message:wpErp.formUnsavedMsg})},viewLogChanges:function(e){e.preventDefault();var t=i(this);wp.ajax.send("erp_audit_log_view",{data:{id:t.data("id"),_wpnonce:wpErp.nonce},success:function(e){i.erpPopup({title:e.title,button:"",id:"erp-audit-log-popup",content:e.content,extraClass:"midium"})},error:function(e){alert(e)}})},setCompanyLogo:function(e){var t;e.preventDefault(),e.stopPropagation(),t||(t=wp.media({title:wpErp.upload_logo,button:{text:wpErp.set_logo}})).on("select",function(){t.state().get("selection").map(function(e){var t='<img src="'+(e=e.toJSON()).url+'" alt="" />';t+='<input type="hidden" name="company_logo_id" value="'+e.id+'" />',t+='<a href="#" class="remove-logo">'+wpErp.remove_logo+"</a>",i(".inside","#postimagediv").html(t)})}),t.open()},removeCompanyLogo:function(e){e.preventDefault();var t='<a href="#" id="set-company-thumbnail" class="thickbox">'+wpErp.upload_logo+"</a>";i(".inside","#postimagediv").html(t)},modalOpen:function(){setTimeout(function(){i("select.erp-country-select").trigger("change")},499)},populateState:function(){if("undefined"==typeof wpErpCountries)return!1;var e=i(this).val(),t=i(".state-field").find("#erp-state"),n='<option value="-1">- Select -</option>';if(wpErpCountries[e]){var o="",a=wpErpCountries[e];for(var r in a)o=o+'<option value="'+r+'">'+a[r]+"</option>";i.isArray(wpErpCountries[e])?t.html(n):t.html(o)}else t.html(n)},pdfNotice:{dismiss:function(e){i.ajax({url:ajaxurl,data:{action:"dismiss_pdf_notice"}})}},customFilter:function(){if("custom"!=this.value)i("#custom-input").remove();else{i("#filter_duration").after('<span id="custom-input"><span>From </span><input name="start" class="erp-date-field" type="text">&nbsp;<span>To </span><input name="end" class="erp-date-field" type="text"></span>&nbsp;'),n.initFields()}},newCompanyLocation:function(e){e.preventDefault();var n=i(this);i.erpPopup({title:n.data("title"),button:wpErp.create,id:"erp-new-location",content:wp.template("erp-address")({company_id:n.data("id")}).trim(),extraClass:"medium",onReady:function(){i(".select2").select2()},onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(e){i("#company-locations").load(window.location.href+" #company-locations-inside"),n.hasClass("erp-add-new-location")||i("body").trigger("erp-hr-after-new-location",[e]),t.closeModal()},error:function(e){t.showError(e)}})}})},editCompanyLocation:function(e){e.preventDefault();var t=i(this);i.erpPopup({title:wpErp.update_location,button:wpErp.update_location,id:"erp-edit-location",content:wp.template("erp-address")(t.data("data")),extraClass:"medium",onReady:function(){i(".select2").select2(),i("li[data-selected]",this).each(function(){var e=i(this),t=e.data("selected");""!==t&&e.find("select").val(t)}),i("select.erp-country-select").change()},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){i("#company-locations").load(window.location.href+" #company-locations-inside"),t.closeModal()},error:function(e){t.showError(e)}})}})},removeCompanyLocation:function(e){e.preventDefault(),confirm(wpErp.confirmMsg)&&wp.ajax.send("erp-delete-comp-location",{data:{id:i(this).data("id"),_wpnonce:wpErp.nonce},success:function(){i("#company-locations").load(window.location.href+" #company-locations-inside")}})},validEmail:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},emailSubscribe:function(e){e.preventDefault();var t=i(".email-subscribe").val();n.validEmail(t)&&(i(this).prop("disabled",!0),i.ajax({url:"https://wedevs.us16.list-manage.com/subscribe/post-json?u=66e606cfe0af264974258f030&id=bc304ef91b&c=?",data:{EMAIL:t},type:"GET",dataType:"json",cache:!1,contentType:"application/json; charset=utf-8"}).success(function(e){i(".erp-newsletter").find(".erp-form-wrap").css("display","none"),i(".erp-newsletter").find(".erp-thank-you").html(e.msg).css("display","block")}))}};i(function(){n.initialize()})}(jQuery),jQuery.fn.serializeObject=function(){var e={},t=this.serializeArray();return jQuery.each(t,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},function(i){"use strict";var p='[data-toggle="erp-dropdown"]',o=function(e){i(e).on("click.erp.dropdown",this.toggle)};function s(e){var t=e.attr("data-target");t||(t=(t=e.attr("href"))&&/#[A-Za-z]/.test(t)&&t.replace(/.*(?=#[^\s]*$)/,""));var n=t&&i(t);return n&&n.length?n:e.parent()}function r(o){o&&3===o.which||(i(".erp-dropdown-backdrop").remove(),i(p).each(function(){var e=i(this),t=s(e),n={relatedTarget:this};t.hasClass("open")&&(o&&"click"==o.type&&/input|textarea/i.test(o.target.tagName)&&i.contains(t[0],o.target)||(t.trigger(o=i.Event("hide.erp.dropdown",n)),o.isDefaultPrevented()||(e.attr("aria-expanded","false"),t.removeClass("open").trigger(i.Event("hidden.erp.dropdown",n)))))}))}o.VERSION="1.0.0",o.prototype.toggle=function(e){var t=i(this);if(!t.is(".disabled, :disabled")){var n=s(t),o=n.hasClass("open");if(r(),!o){"ontouchstart"in document.documentElement&&!n.closest(".navbar-nav").length&&i(document.createElement("div")).addClass("erp-dropdown-backdrop").insertAfter(i(this)).on("click",r);var a={relatedTarget:this};if(n.trigger(e=i.Event("show.erp.dropdown",a)),e.isDefaultPrevented())return;t.trigger("focus").attr("aria-expanded","true"),n.toggleClass("open").trigger(i.Event("shown.erp.dropdown",a))}return!1}},o.prototype.keydown=function(e){if(/(38|40|27|32)/.test(e.which)&&!/input|textarea/i.test(e.target.tagName)){var t=i(this);if(e.preventDefault(),e.stopPropagation(),!t.is(".disabled, :disabled")){var n=s(t),o=n.hasClass("open");if(!o&&27!=e.which||o&&27==e.which)return 27==e.which&&n.find(p).trigger("focus"),t.trigger("click");var a=n.find(".erp-dropdown-menu li:not(.disabled):visible a");if(a.length){var r=a.index(e.target);38==e.which&&0<r&&r--,40==e.which&&r<a.length-1&&r++,~r||(r=0),a.eq(r).trigger("focus")}}}};var e=i.fn.erpDropdown;i.fn.erpDropdown=function(n){return this.each(function(){var e=i(this),t=e.data("erp.dropdown");t||e.data("erp.dropdown",t=new o(this)),"string"==typeof n&&t[n].call(e)})},i.fn.erpDropdown.Constructor=o,i.fn.erpDropdown.noConflict=function(){return i.fn.erpDropdown=e,this},i(document).on("click.erp.dropdown.data-api",r).on("click.erp.dropdown.data-api",".erp-dropdown form",function(e){e.stopPropagation()}).on("click.erp.dropdown.data-api",p,o.prototype.toggle).on("keydown.erp.dropdown.data-api",p,o.prototype.keydown).on("keydown.erp.dropdown.data-api",".erp-dropdown-menu",o.prototype.keydown)}(jQuery);